# FastAPI Microservice Template - Developer Guide

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
uv sync

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
python main.py
```

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞
- `POST /example/process-text` - –ø—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞
- `POST /operations/process` - –æ–±—â–∏–π endpoint –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
- `GET /docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
app/
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic Settings
‚îú‚îÄ‚îÄ auth.py              # Middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ logging_config.py    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ api/                 # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ health.py        # Health check
‚îÇ   ‚îú‚îÄ‚îÄ example.py       # –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ operations.py    # –û–±—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ schemas/             # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ step_schemas.py  # –°—Ö–µ–º—ã –¥–ª—è Step API
‚îÇ   ‚îú‚îÄ‚îÄ health.py        # –°—Ö–µ–º—ã health check
‚îÇ   ‚îî‚îÄ‚îÄ operations.py    # –°—Ö–µ–º—ã –æ–ø–µ—Ä–∞—Ü–∏–π
‚îî‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    ‚îú‚îÄ‚îÄ webhook_service.py    # –û—Ç–ø—Ä–∞–≤–∫–∞ webhook'–æ–≤
    ‚îú‚îÄ‚îÄ alert_service.py      # –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤
    ‚îî‚îÄ‚îÄ operation_service.py # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
```

## üîß –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`app/config.py`)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Pydantic Settings
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–ª–µ—Ä—Ç–æ–≤

### 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (`app/auth.py`)
- Bearer Token middleware
- –ü—É–±–ª–∏—á–Ω—ã–µ endpoints (health, docs)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`app/logging_config.py`)
- JSON-—Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤
- –ú–µ—Ç–∫–∏: service, endpoint, operation_id
- –£—Ä–æ–≤–Ω–∏: DEBUG, INFO, WARNING, ERROR

### 4. Webhook —Å–∏—Å—Ç–µ–º–∞ (`app/services/webhook_service.py`)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ WEBHOOK_AUTH_TOKEN
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ HTTP

### 5. –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤ (`app/services/alert_service.py`)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase Edge Functions
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö 400/500
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

## üìù Step API —Å—Ö–µ–º—ã

### –í—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å (`StepCall`)
```python
{
  "step": {"id": "uuid"},
  "webhook": {"url": "https://..."},
  "initial": {"input": {...}},
  "variables": {...}
}
```

### –û—Ç–≤–µ—Ç (`StepResult`)
```python
{
  "step": {"id": "uuid"},
  "operation": {"operation_id": "uuid"},
  "variables": {...},
  "outputs": [{"data": {...}}]
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
python run_tests.py

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app tests/
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤
- `tests/test_api.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
- `tests/unit/test_services.py` - unit —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
- `tests/conftest.py` - —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –º–æ–∫–∏

## üìä –ë–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥

### –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤
```bash
python run_benchmark.py
```

### –¢–µ—Å—Ç-–∫–µ–π—Å—ã
- Health check
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
- –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## üîÑ Workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞** ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ Bearer token
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚Üí Pydantic —Å—Ö–µ–º—ã
4. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç** ‚Üí 204 + X-Operation-ID
5. **–§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Üí BackgroundTasks
6. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** ‚Üí webhook
7. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Vercel

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`vercel.json`)
```json
{
  "version": 2,
  "builds": [{"src": "app/main.py", "use": "@vercel/python"}],
  "routes": [{"src": "/(.*)", "dest": "app/main.py"}]
}
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel
- `SERVICE_NAME`, `SERVICE_VERSION`
- `AUTH_TOKEN`, `WEBHOOK_AUTH_TOKEN`
- `ALERT_WEBHOOK_URL`, `ALERT_API_KEY`
- `LOG_LEVEL`, `LOG_FORMAT`

## üéØ –§–∏–ª–æ—Å–æ—Ñ–∏—è —à–∞–±–ª–æ–Ω–∞

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `input`
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±–µ–∑ breaking changes

### Stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ù–∏–∫–∞–∫–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ endpoint
1. –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –≤ `app/api/`
2. –î–æ–±–∞–≤–∏—Ç—å —Å—Ö–µ–º—ã –≤ `app/schemas/`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –≤ `app/services/`
4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç–µ—Ä –≤ `main.py`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
1. –†–∞—Å—à–∏—Ä–∏—Ç—å `input` –≤ —Å—Ö–µ–º–∞—Ö
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ —Å–µ—Ä–≤–∏—Å–µ
3. –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Pydantic Settings](https://docs.pydantic.dev/latest/concepts/pydantic_settings/)
- [Structlog](https://www.structlog.org/)
- [Vercel Python](https://vercel.com/docs/functions/serverless-functions/runtimes/python)
